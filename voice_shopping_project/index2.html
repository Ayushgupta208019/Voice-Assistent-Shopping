<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>üé§ Voice Shopping Assistant</title>
  <style>
    body {font-family: Arial,sans-serif;display:flex;height:100vh;margin:0;background:#f7f8fa;}
    #left,#right{flex:1;padding:20px;overflow-y:auto;}
    h2{margin-top:0}
    button{padding:8px 12px;margin:5px;cursor:pointer;border:none;border-radius:5px;background:#007bff;color:white;}
    button:hover{background:#0056b3;}
    .suggestion-box{border:1px solid #ccc;padding:10px;margin-top:10px;background:white;border-radius:6px;}
    .suggestion-box p{margin:4px 0;cursor:pointer;}
    .suggestion-box p:hover{background:#eee;}
    table{width:100%;border-collapse:collapse;margin-top:10px;}
    th,td{border:1px solid #ccc;padding:8px;text-align:center;}
    tfoot td{font-weight:bold;background:#f4f4f4;}
    .qty-btn{padding:4px 8px;margin:0 2px;background:#007bff;color:white;border:none;border-radius:4px;cursor:pointer;}
    .qty-btn:hover{background:#0056b3;}
  </style>
</head>
<body>
  <div id="left">
    <h2>üé§ Voice Assistant</h2>
    <button id="recordBtn">Start Recording</button>
    <div id="output"></div>
    <div class="suggestion-box"><h3>Suggestions</h3><div id="suggestions"></div></div>
    <div class="suggestion-box"><h3>All Products</h3><table id="productTable"><thead><tr><th>Product</th><th>Price</th></tr></thead><tbody></tbody></table></div>
  </div>

  <div id="right">
    <h2>üõí Shopping Cart</h2>
    <table id="cartTable">
      <thead><tr><th>Product</th><th>Price</th><th>Qty</th><th>Action</th></tr></thead>
      <tbody></tbody>
      <tfoot><tr><td colspan="3" style="text-align:right">Total:</td><td id="cartTotal">$0.00</td></tr></tfoot>
    </table>
  </div>

<script>
const BACKEND="http://127.0.0.1:5000";
const recordBtn=document.getElementById("recordBtn");
const outputDiv=document.getElementById("output");
const suggestionsDiv=document.getElementById("suggestions");
const productTable=document.querySelector("#productTable tbody");

async function refreshProducts(){
  const res=await fetch(`${BACKEND}/products`);
  const data=await res.json();
  productTable.innerHTML="";
  data.products.forEach(p=>{
    const row=document.createElement("tr");
    row.innerHTML=`<td>${p.title}</td><td>$${p.price}</td>`;
    productTable.appendChild(row);
  });
}
async function refreshCart(){
  const res=await fetch(`${BACKEND}/cart`);
  const data=await res.json();
  const tbody=document.querySelector("#cartTable tbody");
  tbody.innerHTML="";
  data.cart.forEach(item=>{
    const row=document.createElement("tr");
    row.innerHTML=`
      <td>${item.title}</td>
      <td>$${(item.price*item.quantity).toFixed(2)}</td>
      <td>${item.quantity}</td>
      <td>
        <button class="qty-btn" onclick="updateCart('add','${item.title}')">+</button>
        <button class="qty-btn" onclick="updateCart('remove','${item.title}')">-</button>
      </td>`;
    tbody.appendChild(row);
  });
  document.getElementById("cartTotal").textContent=`$${data.total.toFixed(2)}`;
}
async function updateCart(action,item){
  await fetch(`${BACKEND}/process_voice`,{
    method:"POST",headers:{"Content-Type":"application/json"},
    body:JSON.stringify({text:`${action} ${item}`})
  });
  refreshCart();
}
window.SpeechRecognition=window.SpeechRecognition||window.webkitSpeechRecognition;
if(window.SpeechRecognition){
  const recog=new SpeechRecognition();recog.lang="en-US";recog.interimResults=false;
  recordBtn.addEventListener("click",()=>{outputDiv.innerHTML="<p>üé§ Listening...</p>";recog.start();});
  recog.onresult=async e=>{
    const spoken=e.results[0][0].transcript;
    outputDiv.innerHTML=`<p>You said: ${spoken}</p>`;
    const res=await fetch(`${BACKEND}/process_voice`,{
      method:"POST",headers:{"Content-Type":"application/json"},
      body:JSON.stringify({text:spoken})
    });
    const data=await res.json();
    if(data.intent==="find" && data.suggestions){
      suggestionsDiv.innerHTML=data.suggestions.map(s=>`<p>${s}</p>`).join("");
    }
    refreshCart();
  };
}else{
  outputDiv.innerHTML="<p style='color:red'>‚ùå SpeechRecognition not supported</p>";
}
refreshProducts();
refreshCart();
</script>
</body>
</html>
